version: '3'

services:
  base:
    build: .
    image: "terra-core:${BRANCH:-latest}"
    command: "exit"
  dev:
    image: "terra-core:dev"
    build:
      context: ./
      args:
        - npm_install=false
    ports:
      - 8080:8080
    volumes:
      - .:/opt/module
  standalone-chrome:
    image: 'selenium/standalone-chrome:3.11.0-californium'
    ports:
      - '4444'
    # Necessary due to some issues with chrome in docker.  See https://github.com/SeleniumHQ/docker-selenium#running-the-images
    volumes:
      - '/dev/shm:/dev/shm'
    # Necessary to lock down screen sizes for our screen shot comparisons.
    environment:
      TZ: 'America/Chicago'
      SCREEN_WIDTH: 1070
      SCREEN_HEIGHT: 1020
  test:
    build: .
    image: "terra-core:${BRANCH:-latest}"
    command: "sh /opt/entrypoint/test.sh"
    depends_on:
      - standalone-chrome
    environment:
      - CI=true
    volumes:
      - .:/opt/module